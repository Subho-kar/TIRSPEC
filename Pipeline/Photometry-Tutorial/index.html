<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

        <title>Photometry Tutorial - TIRSPEC Pipeline</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/prettify-1.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">TIRSPEC Pipeline</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../Installing-Pipeline-Requirements/">Installation</a>
                            </li>
                        
                            <li >
                                <a href="../Getting-Started/">Getting Started</a>
                            </li>
                        
                            <li >
                                <a href="../Cookbook-of-Tips-and-Tricks/">Cookbook</a>
                            </li>
                        
                            <li >
                                <a href="../Understanding-various-I-O-files-of-pipeline/">Advanced</a>
                            </li>
                        
                            <li class="active">
                                <a href="./">Photometry Tutorial</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../FAQ/">FAQ</a>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../Understanding-various-I-O-files-of-pipeline/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../FAQ/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#photometry-tutorial">Photometry Tutorial</a></li>
        
            <li><a href="#obtaining-data">Obtaining Data</a></li>
        
            <li><a href="#editing-the-conf-file">Editing the .conf file</a></li>
        
            <li><a href="#starting-the-pipeline">Starting the pipeline</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="photometry-tutorial">Photometry Tutorial</h1>
<p>In this page we will guide you through an example on how to run the photometry pipeline.</p>
<p>Each step in the following flowchart is split into independent tasks. The steps with human face need human interaction to run.
<img alt="Photometry-pipeline-flowchart" src="https://indiajoe.github.io/TIRSPEC/Pipeline/imgs/PhotometryPipeline.png" /></p>
<h2 id="obtaining-data">Obtaining Data</h2>
<p>We will do photometry of Standard stars in AS40 field of Hunt et al 1998. You can download the data from here : <a href="https://drive.google.com/file/d/0B7lhjArL8VfLVTdCWGZSVHpYakk/view?usp=sharing">TIRSPECTutorialData.tar.gz</a></p>
<p>Extract the tar.gz file and keep your nights in some location. Say <code>~/TIRSPECdata/</code></p>
<blockquote>
<p>$ ls ~/TIRSPECdata/</p>
<p>20131102/  20140212/</p>
</blockquote>
<p>Also download and extract the latest version of the tirspec pipeline from <a href="https://github.com/indiajoe/TIRSPEC/tarball/master">here</a> .</p>
<p>All the codes you need for pipeline are in <code>CodesForUser/</code> directory in the downloaded pipeline tar ball.</p>
<h2 id="editing-the-conf-file">Editing the .conf file</h2>
<p>You can copy and rename the <em>TIRSPECscript.conf</em> file to <em>~/TIRSPECdata/TIRSPECscript_AS40.conf</em>
This will help you later find the configuration file you used for this particular reduction.</p>
<p>Open <em>TIRSPECscript_AS40.conf</em> in your favourite text editor and edit the following lines in it.</p>
<blockquote>
<p>OUTPUTDIR= Photometry_of_AS40</p>
<p>OUTPUT= TIRSPECPhotometry_Of_AS40.txt</p>
</blockquote>
<p>If you don't have emacs installed on your machine, you can also change the following line to your favourite editor. (See <a href="https://indiajoe.github.io/TIRSPEC/Pipeline/FAQ/#5-how-do-i-specify-my-favourite-text-editor">FAQ</a> for more examples)</p>
<blockquote>
<p>TEXTEDITOR= "vi"</p>
</blockquote>
<p>Now, you are ready to run the pipeline. We will be reducing AS40 images in <em>20140212</em> directory. 
You can open the file <code>20140212/SlopeimagesLog.txt</code> to see the list of images we will be reducing.</p>
<h2 id="starting-the-pipeline">Starting the pipeline</h2>
<p>You have to run the pipeline code from the directory which contains directory of nights.</p>
<blockquote>
<p>$ cd ~/TIRSPECdata/</p>
</blockquote>
<p>Run the <code>TIRSPECdataReduction.py</code> in this directory with <em>TIRSPECscript_AS40.conf</em> as the first argument.</p>
<blockquote>
<p>$ TIRSPECdataReduction.py  TIRSPECscript_AS40.conf</p>
</blockquote>
<p>You should see a following output, requesting you to enter the list of tasks to run</p>
<pre class="prettyprint well"><code>___________._____________  _______________________________________  
\__    ___/|   \______   \/   _____/\______   \_   _____/\_   ___ \ 
  |    |   |   ||       _/\_____  \  |     ___/|    __)_ /    \  \/ 
  |    |   |   ||    |   \/        \ |    |    |        \     \____
  |____|   |___||____|_  /_______  / |____|   /_______  / \______  /
                       \/        \/                   \/         \/

                                          Data Reduction Pipeline...

----------
IMP: All outputs of this run will be written to the directory /home/joe/TIRSPECdata/Photometry_of_AS40

Very Very Important: Backup your files first. Don't proceed without backup.

 ---------------- Welcome to TIRSPEC Photometry Script ---------------

Enter the Serial numbers (space separated if more than one task in succession)

0  Backup files in current directory to ../DataBackup

1  Selection of object frames, Flats/Sky/Argons to reduce

2  Manually inspect and reject object images by displaying one by one to classify

3  Manually inspect and reject Flats/Sky/Argons by displaying one by one

4  Combine images in a Dither [,subtract sky], apply Flat Correction and Bad pixel interpolation

5  Align and combine combined images of each Dither in Photometry data

6  Make the list of images, Images4Photo.in to do Photometry

7  Select Stars and Sky region of the field on first image

8  Create Sextracter config file &amp; coordinate output of first image in this directory

9  Do Photometry

---------------------------------------------------------------

Steps you have already finished : Nothing...
Enter the list :
</code></pre>
<h3 id="task-1-selection-of-frames-to-reduce">Task 1 (Selection of frames to reduce)</h3>
<p>Here we shall start with the first task 1  (You can also give all the tasks <code>1 2 3 4 5 6 7 8 9</code> together, but for this tutorial we shall run one at a time.) </p>
<pre class="prettyprint well"><code>Enter the list : 1

RUNNING TASK:1  Selection of object frames to reduce

Enter the directories to analyse (default: 20131102,20140212) :
</code></pre>
<p>Here we enter all the directories your target source was observed in comma separated format.
Right now we have only one night data</p>
<pre class="prettyprint well"><code>Enter the directories to analyse (default: 20131102,20140212) : 20140212
----------
For Regular Expression rules See: http://docs.python.org/2/howto/regex.html#regex-howto
Some examples of typical input are shown below
 .*M31.*   is the regular expression to select all the filenames which has "M31" in it.
 .*M31.*sky.*   is to select all the filenames which has both "M31" and then "sky" in it.
While selecting Argon, Flat etc, you can give a range of filenumbers to uniquely choose specific files
 .*Continu.* 140 190   is to select all filenames of _same_ filter which has "Continu" in it and has a filenumber in the range of 140 to 190
----------
Enter Regular Expression to select the objects from all dirs:
</code></pre>
<p>This is the stage where it asks for the regular expression to find your target filenames</p>
<pre class="prettyprint well"><code>Enter Regular Expression to select the objects from all dirs: .*AS40.*

Working on night : 20140212
Below in addition to regexp, if needed you can enter the starting and ending filenumbers separated by space also.
Enter Regular Expression for the flat of filters ('H', 'OPEN', 'OPEN') (default: .*AS40.*) :
</code></pre>
<p>Now it will ask for the regular expression to find the flats of each filter one after other.
It will ask you for all the filters your source was observed in each night.
You can either use the target frames itself for flat fielding, or in this tutorial we shall use separately observed twilight flat frames.</p>
<pre class="prettyprint well"><code>Enter Regular Expression for the flat of filters ('H', 'OPEN', 'OPEN') (default: .*AS40.*) : *.Flat.*
Enter Regular Expression for the flat of filters ('J', 'OPEN', 'OPEN') (default: .*AS40.*) : *.Flat.*
Enter Regular Expression for the flat of filters ('KS', 'OPEN', 'OPEN') (default: .*AS40.*) : *.Flat.*
Edit, save (if required) and close the Flat/Argon/Sky list associations for this night :20140212
Press Enter to continue...
</code></pre>
<p>After you press enter, it will open a text file with first column containing your target filenames and the remaining columns the associated flat frames which will be used.</p>
<p>You can close this file and the pipeline will continue to execute the remaining tasks, The file table is shown at this stage just so that you can verify everything is proceeding as you expected. If you feel like changing something, before closing, make the changes and save the file.</p>
<p>At the end of each run of pipeline it will print </p>
<pre class="prettyprint well"><code>All tasks over....Enjoy!!!
</code></pre>
<h3 id="task-2-manually-inspect-and-acceptreject-object-images">Task 2 (Manually inspect and accept/reject object images)</h3>
<p>Rerun the previous command, but this time when it prompts for the task to execute give <code>2</code></p>
<pre class="prettyprint well"><code>Enter the list : 2
RUNNING TASK:2  Manually inspect and reject object images by displaying one by one to classify

Enter the directories to analyse (default: 20140212) :
</code></pre>
<p>You can press Enter to accept the default
It will start opening you target source raw images one by one image in ds9.</p>
<p>Press <code>a</code> and then <code>q</code> over one good central star for selecting image.<br />
In case a bad frame comes up, Press <code>q</code> without pressing <code>a</code> to discard the image.
<img alt="imexam-cursor" src="https://indiajoe.github.io/TIRSPEC/Pipeline/imgs/imexamMark.png" /></p>
<p>Once all images in that night are over, it will display all the images as set of paragraphs in text editor, you can add or delete space in between them if you need to manually edit the detected dithered sets.</p>
<pre class="prettyprint well"><code>We have made the selected list of images in /home/joe/TIRSPECdata/Photometry_of_AS40/20140212/AllObjects2Combine.List 
Add blank lines between file names to prevent them from median combining. 
Remove the blank line between file names, which you want to combine.
Press Enter to continue...
</code></pre>
<h3 id="task-3-manually-inspect-and-acceptreject-flatsskyargons">Task 3 (Manually inspect and accept/reject Flats/Sky/Argons)</h3>
<pre class="prettyprint well"><code>Enter the list : 3
RUNNING TASK:3  Manually inspect and reject Flats/Sky/Argons by displaying one by one
Enter the directories to analyse (default: 20140212) :


Working on night : 20140212
-*--*--*--*--*--*--*--*-
Files in:/home/joe/TIRSPECdata/Photometry_of_AS40/20140212/AllObjects-Flat.List
-*--*--*--*--*--*--*--*-
-----
To skip all the remaining verifications, you can enter following two options
acceptall       # Accept all remaining images in this night
acceptallnights # Accept all images in all remaining nights
Use the above two options only when you are sure all the images are good. Do not use them if you are not sure.
-----
For the science image: Slope-AS40-??.fits
z1=16.55243 z2=26.27585
20140212/Flat-J-*.fits
Enter "r" to reject, "ra" to reject always in future, "aa" to always accept in future:
</code></pre>
<p>At this stage it will also display images one by one, You can give <code>acceptall</code> to accept all the flats blindly of this night, <code>acceptallnights</code> to accept all flats from all nights.
To be safe, type <code>aa</code>  to accept the displayed image.</p>
<p><em>Tip: Use up arrow to get previously typed entry.</em></p>
<h3 id="task-4-combine-images-in-a-dither-apply-flat-sky-correction-bad-pixel-interpolation">Task 4 (Combine images in a Dither, apply Flat , Sky correction, Bad pixel interpolation)</h3>
<pre class="prettyprint well"><code>Enter the list : 4
RUNNING TASK:4  Combine images in a Dither [,subtract sky], apply Flat Correction and Bad pixel interpolation
</code></pre>
<p>It will automatically do Flat correction, sky subtraction if you had asked for it, and also combine images in each dither position.</p>
<h3 id="task-5-align-and-combine-dithers">Task 5 (Align and combine dithers)</h3>
<pre class="prettyprint well"><code>Enter the list : 5
RUNNING TASK:5  Align and combine combined images of each Dither in Photometry data

Press _a_ over a few (~ 4 or 5) good stars to align, u can press s also, but DONT press r
</code></pre>
<p>For each set of filter in a night it will display the first dither position image and you have to press <code>a</code> over a few good stars. These star's coordinates will be used for automatically aligning remaining frames of that night in that that filter.<br />
So after selecting a few stars you can press <code>q</code> to continue to next filter/night data.</p>
<h3 id="task-6-final-reduced-images-list">Task 6 (Final Reduced Images list)</h3>
<pre class="prettyprint well"><code>Enter the list : 6
RUNNING TASK:6  Make the list of images, Images4Photo.in to do Photometry
</code></pre>
<p>If all you wanted was final reduced images you can stop at this task, you need to proceed further if you need to do photometry of the sources in the field.</p>
<h3 id="task-7-selecting-objects-of-interest">Task 7 (Selecting objects of interest)</h3>
<pre class="prettyprint well"><code>Enter the list : 7
RUNNING TASK:7  Select Stars and Sky region of the field on first image
</code></pre>
<h3 id="task-8-create-sextractor-and-bright-star-list-files">Task 8 (Create Sextractor and bright star list files)</h3>
<pre class="prettyprint well"><code>Enter the list : 8
RUNNING TASK:8  Create Sextracter config file &amp; coordinate output of first image in this directory
</code></pre>
<h3 id="task-9-do-photometry">Task 9 (Do Photometry)</h3>
<pre class="prettyprint well"><code>Enter the list : 9
RUNNING TASK:9  Do Photometry
</code></pre>
<p>The output file <code>Photometry_of_AS40/TIRSPECPhotometry_Of_AS40.txt</code> will be created with a summary of the <strong>instrumental</strong> magnitudes.
A full output including errors etc in machine readable format with <code>|</code> delimiter will be written to <code>Photometry_of_AS40/TIRSPECPhotometry_Of_AS40.txt_FullOutput.txt</code> . You can open this file in <code>libreoffice calc</code> with delimiter other=<code>|</code> to read the content of the output in a tabular form.</p>
<p><em>LibreOffice Calc Tip: Use Data-&gt;Filter-&gt;AutoFilter to select the outputs based on filter. This is extremely useful while dealing with many nights of data.</em></p>
</div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/prettify-1.0.min.js"></script>
        <script src="../js/base.js"></script>
        
    </body>
</html>